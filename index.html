<html>

	<head>

		<!-- we want to use D3, so this is where the D3 library version 5 gets called-->
		<script src="https://d3js.org/d3.v5.js"></script>

		<!-- Leaflet Stylesheet -->
		 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
			integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="crossorigin=""/>
   
		 <!-- Leaflet library -->
		<script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
		integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="crossorigin=""></script>

		<!--title of the webpage-->
		<title> CS5044 Practical 3 </title>

	</head>

	<body>

		<h1>Did Weather Affect Aerial Missions in WW2?</h1>
		<script>

			//setting up what data we want to grab from each dataset
			var weatherConverter = function(d)
      {
        	var yr = d.YR;
        	var mo = d.MO;
          var day = d.DA;

	        return{
        			date: new Date(+yr, +mo-1,+day),
        			Station: d.STA,
        			Precipitation: d.PRCP,
	        		peakWindSpeed: d.SPD,
        			maxTemp: d.MAX,
        			minTemp: d.MIN,
        			meanTemp: d.MEA,
							latitude: d.LAT,
							longitude: d.LON
	        }
      }

			var opsConverter = function(d)
      {
        	var timeData = d['Mission Date'];
					var datum = timeData.split("/");

	        return{
        			date: new Date(+datum[2], +datum[0]-1,+datum[1]),
							theaterOfOperations: d['Theater of Operations'],
							country: d.Country,
							airForce: d['Air Force'],
							aircraftSeries: d['Aircraft Series'],
							missionType: d['Mission Type'],
							targetCountry: d['Target Country'],
							targetCity: d['Target City'],
							targetType: d['Target Type'],
							targetIndustry: d['Target Industry'],
							targetPrio: d['Target Priority'],
							altitude: d['Altitude (Hundreds of Feet)'],
							airboneAircraft: d['Airborne Aircraft'],
							attackingAircraft: d['Attacking Aircraft'],
							bombingAircraft: d['Bombing Aircraft'],
							highExplosiveWeight: d['High Explosives Weight (Pounds)'],
							totalWeight: d['Total Weight']

	        }
      }

			var dataOps = "data/operations.csv";
			var dataWeather = "data/ww2-weather.csv";
			var stationList = "data/station-list.csv";

			var promises = [d3.csv(dataOps, opsConverter), d3.csv(dataWeather, weatherConverter), d3.csv(stationList)];

			Promise.all(promises).then(ready);

			function ready(data)
			{
				//looking up and adding longitude and latitude of Weather station to weather data
				data[1].forEach(function(weatherD) {
			    var result = data[2].filter(function(stationD) {
			        return stationD.WBAN === weatherD.Station;
			    });
			    weatherD.latitude = (result[0] !== undefined) ? result[0].LAT : null;
					weatherD.longitude = (result[0] !== undefined) ? result[0].LON : null;
				});

				console.log(data)
				var svgDoc = d3.select("body").append("svg").attr("width", 700).attr("height", 350);



			}


		</script>
		Testing the map stuff:
		<style>
			#map
			{
				width: 100%;
				height: 90%;
			}
		</style>
		<!--Magical Map div-->	
		<div id="map"></div>
		<script src="scripts/map.js"></script>
	</body>

</html>
